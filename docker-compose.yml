version: "3.8"

services:
  gmail-datalake-extractor:
    build: .
    container_name: gmail-datalake-extractor-api
    environment:
      # Server configuration
      SERVER_HOST: ${SERVER_HOST:-0.0.0.0}
      SERVER_PORT: ${SERVER_PORT:-8000}
      SERVER_RELOAD: ${SERVER_RELOAD:-false}
      SERVER_LOG_LEVEL: ${SERVER_LOG_LEVEL:-INFO}

      # Database configuration
      DUCKLAKE_SETUP_PATH: ${DUCKLAKE_SETUP_PATH:-/run/secrets/ducklake_setup}

      # Gmail API configuration
      GMAIL_API_TOKEN_PATH: ${GMAIL_API_TOKEN_PATH:-/app/data/token.json}
      GMAIL_API_SCOPES: ${GMAIL_API_SCOPES:-https://www.googleapis.com/auth/gmail.readonly}
    secrets:
      - ducklake_setup
    volumes:
      - ./secrets/token.json:/app/data/token.json
    ports:
      - "8080:${SERVER_PORT:-8000}"
    restart: unless-stopped

secrets:
  ducklake_setup:
    file: ./secrets/ducklake_setup.sql
